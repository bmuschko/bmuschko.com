<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="author" content="map[]" />
    
    <link rel="shortcut icon" type="image/x-icon" href="https://bmuschko.com/img/favicon.ico">
    <title>Containerization workflow for Java apps with Jib</title>
    <meta name="generator" content="Hugo 0.84.0" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="https://bmuschko.com/css/main.css" /><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.11.0/styles/darcula.min.css">
    
    <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" />
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,400,200bold,400old" />
    
    <!--[if lt IE 9]>
			<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
			<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
		<![endif]-->

    
        
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-99678333-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
    
  </head>

  <body>
    <div id="wrap">

      
      <nav class="navbar navbar-default">
  <div class="container">
    <div class="navbar-header">
      <a class="navbar-brand" href="https://bmuschko.com/"><i class="fa fa-home"></i></a>
    </div>
    <div id="navbar">
      <ul class="nav navbar-nav navbar-right">
      
        
        <li><a href="/blog/">BLOG</a></li>
        
        <li><a href="/talks/">TALKS</a></li>
        
      
      </ul>
    </div>
  </div>
</nav>

      <div class="container">
        <div class="blog-post">
          <h3>
            <strong><a href="https://bmuschko.com/blog/containerization-with-jib/">Containerization workflow for Java apps with Jib</a></strong>
          </h3>
        </div>
        <div class="blog-title">
          <h4>
            
            <span class="label label-success">java</span>
            
            <span class="label label-success">build</span>
            
            <span class="label label-success">docker</span>
            
            <span class="label label-success">container</span>
            
            <span class="label label-success">gradle</span>
            
            <span class="label label-success">maven</span>
            
            <span class="label label-success">google</span>
            
            </br></br></br>
            October 16, 2018
          </h4>
        </div>
        <div class="panel panel-default">
          <div class="panel-body">
            <div class="blogpost">
              <div class="paragraph">
<p>Containerizing a Java application is the natural extension to building a plain, executable JAR file: &#34;write once, run everywhere&#34;. Creating an optimized image for an application is far from straightforward and requires in-depth knowledge of Docker concepts and <a href="https://docs.docker.com/develop/develop-images/dockerfile_best-practices/">best practices</a>.</p>
</div>
<div class="paragraph">
<p>A typical developer worflow involves the following steps. First, you start out by writing a Dockerfile with the goal of producing an image small in size while at the same time ensuring cacheability of layers as much as possible. Next, you’ll have think about how to build and push the image to a registry. This process usually involves installing the Docker engine and providing registry credentials. If you are a beginner to containers and/or Docker, Google’s containization tool <a href="https://github.com/GoogleContainerTools/jib">Jib</a> might be a good fit for you.</p>
</div>
<div class="sect1">
<h2 id="_meet_jib">Meet Jib</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Jib is a library for building and pushing OCI-compatible images for Java applications available as Maven and Gradle plugin. Setting up the tool for a project requires very little configuration.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="/img/blog/containerization-with-jib/jib-logo.png" alt="jib logo"/></span></p>
</div>
<div class="paragraph">
<p>Jib’s main goal is fast image creation by using a <a href="https://github.com/GoogleContainerTools/distroless">distroless base image</a> and splitting up the application into meaningful, fine-grained layers. Jib doesn’t require setting up a Dockerfile or even installing the Docker engine to get the job done. Let’s have a look at an example in a Gradle build.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_using_jib_in_a_gradle_build">Using Jib in a Gradle build</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Building Docker images is a very common workflow for microservice-based architectures. Imagine you wanted to create and push an image for a web application based on the Spring Boot framework. Listing 1 shows the basic setup of a plain Spring Boot application.</p>
</div>
<div class="paragraph">
<p><em>build.gradle</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">plugins {
    id &#39;java&#39;
    id &#39;org.springframework.boot&#39; version &#39;2.0.5.RELEASE&#39;
    id &#39;io.spring.dependency-management&#39; version &#39;1.0.6.RELEASE&#39;
}

repositories {
    jcenter()
}

dependencies {
    implementation &#39;org.springframework.boot:spring-boot-starter-web&#39;
    implementation &#39;org.springframework.boot:spring-boot-starter-actuator&#39;
    implementation &#39;org.springframework.boot:spring-boot-starter-data-jpa&#39;
    runtime &#39;org.postgresql:postgresql:42.2.5&#39;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>Listing 1. Building a Spring Boot application with Gradle</em></p>
</div>
<div class="paragraph">
<p>Adding Jib to the build process is simple. Just apply the Jib Gradle plugin with a specific version. Optionally, you can also provide custom configuration to control the runtime behavior of the plugin. Listing 2 shows how to enhance the existing build script by applying the Jib plugin and providing a tag for the image.</p>
</div>
<div class="paragraph">
<p><em>build.gradle</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">plugins {
    id &#39;com.google.cloud.tools.jib&#39; version &#39;0.9.11&#39;
}

jib.to.image = &#39;bmuschko/my-java-app:1.0&#39;</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>Listing 2. Declaring and configuring the Jib Gradle plugin</em></p>
</div>
<div class="paragraph">
<p>With these 4 lines of code in place, it is already possible to execute the containerization workflow by running the <code>jib</code> task. The following output should give you a hint on its inner workings:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">$ ./gradlew jib --console=verbose
&gt; Task :compileJava UP-TO-DATE
&gt; Task :processResources UP-TO-DATE
&gt; Task :classes UP-TO-DATE
warning: Base image &#39;gcr.io/distroless/java&#39; does not use a specific image digest - build may not be reproducible

Containerizing application to bmuschko/java-app-jib:1.0...

Retrieving registry credentials for registry.hub.docker.com...
Getting base image gcr.io/distroless/java...
Building dependencies layer...
Building resources layer...
Building classes layer...
Finalizing...
&gt; Task :jib

Container entrypoint set to [java, -cp, /app/resources:/app/classes:/app/libs/*, com.bmuschko.todo.webservice.Application]

Built and pushed image as bmuschko/java-app-jib:1.0</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can see in the console output that the tool creates separate layers for the application dependencies, the resource files and the class files. Jib also determines the main class name by scanning the classpath.</p>
</div>
<div class="paragraph">
<p>Based on the provided image name, Jib identifies that the image should be pushed to Docker Hub, retrieves my stored credentials with the help of <a href="https://github.com/docker/docker-credential-helpers">docker-credential-helpers</a> and finally performs the operation. You can verify that Jib didn’t actually create an image via the Docker engine by running <code>docker images</code>. There’s no image with the tag <code>bmuschko/java-app-jib:1.0</code> to be found.</p>
</div>
<div class="paragraph">
<p>Building and pushing images independent of the Docker engine can be extremely powerful. Jib completely abstracts the implementation details from the developer. There’s no need to fully understand the details. You can simply trust that Jib produces the desired outcome. Avoiding the need to install Docker is highly beneficial in CI/CD environments. CI agents can perform containerization tasks without the burden of setting up and maintaining yet another tool.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_using_docker">Using Docker</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Jib offers the option to use the Docker engine instead of its own, internal implementation. The task <code>jibDockerBuild</code> takes care of building the image by invoking the <code>docker</code> command line tool.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">$ docker images
REPOSITORY             TAG  IMAGE ID      CREATED       SIZE
bmuschko/java-app-jib  1.0  a6feced9e4b7  48 years ago  152MB</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default the <code>jibDockerBuild</code> task builds the image &#34;on the fly&#34; and doesn’t leave behind temporary artifacts. Sometimes you might want to understand the processing step on a Docker-level though. The task <code>jibExportDockerContext</code> prepares the Dockerfile context in the directory <code>build/jib-docker-context</code> for further inspection. The context directory includes the <code>Dockerfile</code> shown in listing 3.</p>
</div>
<div class="paragraph">
<p><em>Dockerfile</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">FROM gcr.io/distroless/java

COPY libs /app/libs/
COPY resources /app/resources/
COPY classes /app/classes/

ENTRYPOINT [&#34;java&#34;,&#34;-cp&#34;,&#34;/app/resources:/app/classes:/app/libs/*&#34;,&#34;com.bmuschko.todo.webservice.Application&#34;]
CMD []</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>Listing 3. A Dockerfile created by Jib</em></p>
</div>
<div class="paragraph">
<p>It turns out that Jib doesn’t even produce a JAR file to run a containerized Java application. Running the image in a container executes the <code>java</code> command and points to the necessary classpath resources. In a large project with a thousands of source files, avoiding the execution of the <code>jar</code> task can slightly improve the overall build time.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_summary">Summary</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Jib is great for simple containerization workflows. Adopt, adopt, adopt if don’t want to dig deeper into Docker. More complex workflows or intricate customization of image instructions call for a different tool. Jib stops at &#34;build an image and push it to a registry&#34;. The <a href="https://github.com/bmuschko/gradle-docker-plugin">Gradle Docker plugin</a> is a suitable alternative for any Gradle build process that wants to go further.</p>
</div>
</div>
</div>

              <hr>
              <div class="related-posts">
                <h5>Related Posts</h5>
                
                  <div class="row">
                    <div class="col-sm-4 col-md-4 col-lg-4">
                      <h6 style="text-align: right">
                        February 1, 2020
                      </h6>
                    </div>
                    <div class="col-sm-8 col-md-8 col-lg-8">
                      <h6 style="text-align: left">
                        <strong><a href="/blog/bazel-groovy/">Building Groovy with Bazel</a></strong>
                      </h6>
                    </div>
                  </div>
                
                  <div class="row">
                    <div class="col-sm-4 col-md-4 col-lg-4">
                      <h6 style="text-align: right">
                        October 31, 2019
                      </h6>
                    </div>
                    <div class="col-sm-8 col-md-8 col-lg-8">
                      <h6 style="text-align: left">
                        <strong><a href="/blog/jenkins-shared-libraries/">Best practices for writing Jenkins shared libraries</a></strong>
                      </h6>
                    </div>
                  </div>
                
                  <div class="row">
                    <div class="col-sm-4 col-md-4 col-lg-4">
                      <h6 style="text-align: right">
                        November 12, 2018
                      </h6>
                    </div>
                    <div class="col-sm-8 col-md-8 col-lg-8">
                      <h6 style="text-align: left">
                        <strong><a href="/blog/java-project-testcontainers/">Testing a Java project with TestContainers on JUnit 5</a></strong>
                      </h6>
                    </div>
                  </div>
                
              </div>
            </div>
          </div>
          <hr>
        <div class="disqus">
  <div id="disqus_thread"></div>
  <script type="text/javascript">

    (function() {
      
      
      if (window.location.hostname == "localhost")
        return;

      var disqus_shortname = 'bmuschko-com';
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  <a href="http://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>
        </div>
      </div>
    </div>

    
    <footer>
  <div id="footer">
    <div class="container">
      <p class="text-muted">&copy; All rights reserved. Powered by <a href="https://gohugo.io/">Hugo</a> and
      <a href="http://www.github.com/nurlansu/hugo-sustain/">sustain</a> with ♥</p>
    </div>
  </div>
</footer>
<div class="footer"></div>


<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>

<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<script src="https://bmuschko.com/js/docs.min.js"></script>
<script src="https://bmuschko.com/js/main.js"></script>

<script src="https://bmuschko.com/js/ie10-viewport-bug-workaround.js"></script><!-- Syntax highlighting -->
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.11.0/highlight.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.11.0/languages/shell.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.11.0/languages/groovy.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.11.0/languages/yaml.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>



    
  </body>
</html>
